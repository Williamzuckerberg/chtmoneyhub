qing.registNS("qdetail");qdetail.ListenerMgr=(function(){var h=function(i){if(qVisitorInfo.loginStatus=="not_login"){qing.event.stop(i);qui.showLogin();return false}else{if(qVisitorInfo.loginStatus!="activated"){qing.event.stop(i);qui.showActive();return false}}return true};var a=function(k){var j=qext.fn.getAncestorByClass(this,"mod-repost-content");var i=qing.dom.query(".q-reasonitem",j);qing.array.each(i,function(l){qing.dom.removeClass(l,"hide")});qing.dom.removeClass(this,"a-expand-reason");qing.dom.addClass(this,"a-collapse-reason");this.innerHTML="收起";qing.event.stop(k)};var e=function(k){var j=qext.fn.getAncestorByClass(this,"mod-repost-content");var i=qing.dom.query(".q-reasonitem",j);qing.array.each(i,function(m,l){if(l===0){return}qing.dom.addClass(m,"hide")});qing.dom.removeClass(this,"a-collapse-reason");qing.dom.addClass(this,"a-expand-reason");this.innerHTML="查看更多转载理由";qing.event.stop(k)};var d=function(i){var j=this;qui.showTip({width:140,height:20,msg:"确定要删除这篇博客吗？",target:j,anchor:"top",buttons:[{text:"确定",handler:function(l,k){qing.ajax.post("/pub/submit/deleteblog",{qbid:detailPage.threadId,bdstoken:qBdsToken},function(m){qui.showSuccess("删除成功");l.close();setTimeout(function(){var n=qPageInfo.referUrl;if(!n||!/^http/.test(n)){n=qDomain.qing+"/new"+qUserInfo.qingUrl+"/blog"}location.href=n},600)},function(m){qui.showError("删除失败");l.close()})}},{text:"取消",type:"silver",handler:function(l,k){l.close()}}]});qing.event.stop(i)};var f=function(k){if(!h(k)){return false}var l=this;var m={};m.name=detailPage.originAuthorName;m.portrait=detailPage.originPortrait;var o=qing.dom.query("#shareBnt .share-nub")[0];var n=qing.dom.query("#commentBnt .comment-nub")[0];var i=function(t,q,r){if(q.toReplyeeId){if(r.indexOf("回")==0){r=r.replace("回复 "+q.toReplyeeName+"：","")}else{q.toReplyeeId=""}}var v="";if(q.toReplyeeId){v=qing.string.format(qcmt.tpl.cmtReplyDetailTpl,{userUrl:qDomain.qing+"/go/check?portrait="+q.userInfo.portrait,userName:q.userInfo.userName,replyeeUrl:q.toUrl,replyeeName:q.toReplyeeName,summary:qing.string.filterFormat.escapeString(r),isWiseIcoShowClass:"hide"})}else{v=qing.string.format(qcmt.tpl.cmtDetailTpl,{userUrl:qDomain.qing+"/go/check?portrait="+q.userInfo.portrait,userName:q.userInfo.userName,summary:qing.string.filterFormat.escapeString(r),isWiseIcoShowClass:"hide"})}var s="";if(t&&t[0]&&t[0].replyIdEnc){s=t[0].replyIdEnc}else{return}var u=qing.string.format(qcmt.tpl.cmtItem,{userUrl:qDomain.qing+"/go/check?portrait="+q.userInfo.portrait,userId:q.userInfo.portrait,userName:q.userInfo.userName,imgUrl:q.userInfo.avatar,cmtDetailTpl:v,cmtId:s,cmtPubTime:qing.date.format(new Date(t[0].cdatetime*1000),"yyyy-MM-dd HH:mm"),isHoverShowClass:"delete-hover-show",isReplyHideClass:"hide"});var p=qing.dom.query(".cmt-list")[0];qing.dom.insertHTML(p,"afterBegin",u)};qext.fn.scrollFix(l);var j=qing.g("shareDetail");qdetail.repostBuilder=qcmt.build(j,{type:"repost",target:l,numElem:o,extraNumElem:n,id:detailPage.threadId,actorPortrait:qUserInfo.portrait,actorName:qUserInfo.userName,actorQingUrl:qUserInfo.qingUrl,contentType:detailPage.contentType,originAuthor:m,originThreadId:detailPage.originThreadId,repostSuccess:i,count:20,max:100000000})};var b=function(i){if(!h(i)){return false}qing.dom.query("#commentDetail .qcmt-textarea-box")[0].focus();qdetail.repostBuilder&&qdetail.repostBuilder.destroy()};var c={click:{"share-bnt":f,"comment-bnt":b,"a-expand-reason":a,"a-collapse-reason":e,"delete-bnt":d},mouseover:{},mouseout:{}};var g=function(){qext.fn.addEventMap(qing.dom.q("mod-page-main")[0],["click","mouseover","mouseout"],c)};return{run:g}})();qing.registNS("qdetail");qdetail.main=(function(){var b=function(k,i,l){var j=new Image();j.onload=function(){var o=j.width,m=j.height;if(o&&m){var n=o/m;if(o>i){k.width=i;k.height=i/n}}if(l){l()}};j.src=k.src};var d=function(){if(!qing.browser.ie&&qing.browser.ie>6){return}var i=qing.dom.query(".text-content img");qing.array.each(i,function(l,k){var j=qing.dom.getAncestorByClass(l,"content").clientWidth;b(l,j)})};var h=function(){var j=qing.dom.g("commentDetail");if(!j){return}var i=qing.dom.query("#commentDetail .comment-content")[0],l=qing.g("commentBnt"),k=qing.dom.query("#commentBnt .comment-nub")[0];if(!i){return}var m=function(){var u=qing.dom.query("#commentDetail .qcmt-textarea-box")[0];var r=location.hash.replace(/^#/,"");var t=40;var s=qing.browser.isWebkit?document.body:document.documentElement;var q=s.scrollTop;if(r=="reply"){u.focus();qext.fn.scrollFix(u);var o=qing.dom.getPosition(u).top-t;var n=o<0?0:o;s.scrollTop=n}else{var p=qing.g(r);if(p){var o=qing.dom.getPosition(p).top-t;var n=o<0?0:o;s.scrollTop=n}}};qdetail.cmtBuilder=qcmt.build(i,{type:"comment",target:l,numElem:k,focus:false,callback:m,bindTargetEvent:false,id:detailPage.threadId,actorPortrait:qUserInfo.portrait,actorQingUrl:qUserInfo.qingUrl,count:20,max:10000000000})};var f=function(){var k=qing.g("content"),j=qing.dom.query(".mod-post-content .description")[0],i=[];if(j){qing.dom.query("ul",j,i);qing.dom.query("ol",j,i)}if(k){qing.dom.query("ul",k,i);qing.dom.query("ol",k,i)}qing.array.each(i,function(m,l){if(m.style.listStyleType&&m.style.listStyleType!="none"){m.style.marginLeft="35px"}})};var e=function(){var i=baidu.dom.query(".op-box")[0],j=baidu.dom.query(".tag-box")[0];if(j&&i){var k=i.offsetHeight;if(k>20){baidu.dom.setStyles(j,{"float":"none",display:"block"})}}};var a=function(){if(qVisitorInfo.isHost){return}if(location.hash=="#repost"){var i=qing.dom.q("share-bnt")[0];if(i){qing.event.fire(i,"click")}}};var c=function(){qext.back2top.init()};var g=function(){qext.lazy.ImageLoad.init();d();qdetail.ListenerMgr.run();a();h();f();e();c()};return{init:g}})();qing.dom.ready(function(){qdetail.main.init()});